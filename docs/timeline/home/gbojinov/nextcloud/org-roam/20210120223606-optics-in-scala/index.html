<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="[Georgi Bojinov]">
<meta name="description" content="Peering into Scala optics with Monocle Introduction Salutations. Today i&amp;rsquo;m going to do an overview of one of my favourite functional programming concepts - optics. Most articles on this topic focus on Haskell so I&amp;rsquo;m going to try to present the topic using Scala and the Monocle library.
My assumptions for the reader is that they are familiar with basic functional Scala, the concept of type classes and some of the more popular ones." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="http://notes.gbojinov.xyz/timeline/home/gbojinov/nextcloud/org-roam/20210120223606-optics-in-scala/" />


    <title>
        
            Optics in Scala :: Notes 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css"> 




<link rel="stylesheet" href="/main.805b1025016494ee5fd67b55b8ecd5e2b7c4a9f0bdda42e300c62b85ddfef68f.css">


  

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#252627">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="#252627">
    <meta name="theme-color" content="#252627">



<meta itemprop="name" content="Optics in Scala">
<meta itemprop="description" content="Peering into Scala optics with Monocle Introduction Salutations. Today i&rsquo;m going to do an overview of one of my favourite functional programming concepts - optics. Most articles on this topic focus on Haskell so I&rsquo;m going to try to present the topic using Scala and the Monocle library.
My assumptions for the reader is that they are familiar with basic functional Scala, the concept of type classes and some of the more popular ones.">
<meta itemprop="datePublished" content="2021-01-20T00:00:00+02:00" />
<meta itemprop="dateModified" content="2021-01-20T00:00:00+02:00" />
<meta itemprop="wordCount" content="2718">



<meta itemprop="keywords" content="" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Optics in Scala"/>
<meta name="twitter:description" content="Peering into Scala optics with Monocle Introduction Salutations. Today i&rsquo;m going to do an overview of one of my favourite functional programming concepts - optics. Most articles on this topic focus on Haskell so I&rsquo;m going to try to present the topic using Scala and the Monocle library.
My assumptions for the reader is that they are familiar with basic functional Scala, the concept of type classes and some of the more popular ones."/>







    <meta property="article:published_time" content="2021-01-20 00:00:00 &#43;0200 EET" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="http://notes.gbojinov.xyz" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">Notes</span>
            <span class="logo__text"></span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="http://notes.gbojinov.xyz/timeline/">Timeline</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
             
            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        13 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="http://notes.gbojinov.xyz/timeline/home/gbojinov/nextcloud/org-roam/20210120223606-optics-in-scala/">Optics in Scala</a>
      </h1>

      

      <div class="post-content">
        <h2 id="peering-into-scala-optics-with-monocle">Peering into Scala optics with Monocle</h2>
<h3 id="introduction">Introduction</h3>
<p>Salutations. Today i&rsquo;m going to do an overview of one of my favourite functional programming concepts - optics. Most articles on this topic focus on Haskell so I&rsquo;m going to try to present the topic using Scala and the <a href="https://github.com/optics-dev/monocle">Monocle</a> library.</p>
<p>My assumptions for the reader is that they are familiar with basic functional Scala, the concept of type classes and some of the more popular ones.</p>
<h3 id="optics-the-what-and-the-why">Optics - The What and The Why</h3>
<p>Let&rsquo;s start with an example.
The examples of this post are taken from this fantastic page about optics: <a href="https://impurepics.com/posts/2020-03-22-optics.html">Link</a></p>
<h4 id="initial-steps">Initial steps</h4>
<p>Let&rsquo;s define some types.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Types</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Name</span><span style="color:#f92672">(</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">AnyVal</span>
  <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Stock</span><span style="color:#f92672">(</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">AnyVal</span>

  <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Bar</span><span style="color:#f92672">(</span>fridges<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Fridge</span><span style="color:#f92672">])</span>
  <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Fridge</span><span style="color:#f92672">(</span>beers<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Beer</span><span style="color:#f92672">])</span>
  <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Beer</span><span style="color:#f92672">(</span>name<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Name</span><span style="color:#f92672">],</span> stock<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Stock</span><span style="color:#f92672">])</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>And here&rsquo;s what a <code>Bar</code> would look like sent over an API in a format like JSON:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#e6db74">&#34;fridges&#34;</span><span style="color:#f92672">:</span> [{
    <span style="color:#e6db74">&#34;beers&#34;</span><span style="color:#f92672">:</span> [
      {
        <span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Starobrno&#34;</span>,
        <span style="color:#e6db74">&#34;stock&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">5</span>
      },
      {
        <span style="color:#e6db74">&#34;stock&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span>
      }
    ]
  },
  {
    <span style="color:#e6db74">&#34;beers&#34;</span><span style="color:#f92672">:</span> [
      {
        <span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Starobrno&#34;</span>,
      },
      {
        <span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Staropramen&#34;</span>,
        <span style="color:#e6db74">&#34;stock&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">6</span>
      }
    ]
  }]
}
</code></pre></div><p>Objects in the real world can look quite a bit more nested than this, but it&rsquo;s a good place to start.</p>
<h4 id="let-s-play-around-with-our-data">Let&rsquo;s play around with our data</h4>
<p>So we&rsquo;re imagining we&rsquo;re a bar and we store information about the beers we&rsquo;re selling and how many we have in stock. Of course, we keep them in a fridge, and our bar has multiple fridges. Not every beer has a name or a stock. (Maybe we brew our own type of beer!)</p>
<p>Let&rsquo;s walk through a couple of use cases of what we would like to do with our beers.</p>
<ul>
<li>
<p>We receive a shipment of beers for our first fridge and we would like to bump all of our stock by a certain amount. How would we do that?</p>
<p>Here&rsquo;s a way with regular (functional and immutable) Scala:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">  <span style="color:#66d9ef">val</span> beer1 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Beer</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Name</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Starobrno&#34;</span><span style="color:#f92672">)),</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Stock</span><span style="color:#f92672">(</span><span style="color:#ae81ff">5</span><span style="color:#f92672">)))</span>
  <span style="color:#66d9ef">val</span> beer2 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Beer</span><span style="color:#f92672">(</span><span style="color:#a6e22e">None</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Stock</span><span style="color:#f92672">(</span><span style="color:#ae81ff">3</span><span style="color:#f92672">)))</span>
  <span style="color:#66d9ef">val</span> bar <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Bar</span><span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Fridge</span><span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>beer1<span style="color:#f92672">,</span> beer2<span style="color:#f92672">))))</span>

  <span style="color:#75715e">// Woo, a shipment comes!
</span><span style="color:#75715e"></span>
  <span style="color:#66d9ef">val</span> updatedBar <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Bar</span><span style="color:#f92672">(</span>
  bar<span style="color:#f92672">.</span>fridges<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span>fridge <span style="color:#66d9ef">=&gt;</span>
    <span style="color:#a6e22e">Fridge</span><span style="color:#f92672">(</span>fridge<span style="color:#f92672">.</span>beers<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span>beer <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#a6e22e">Beer</span><span style="color:#f92672">(</span>beer<span style="color:#f92672">.</span>name<span style="color:#f92672">,</span> beer<span style="color:#f92672">.</span>stock<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span>s <span style="color:#66d9ef">=&gt;</span>
        <span style="color:#a6e22e">Stock</span><span style="color:#f92672">(</span>s<span style="color:#f92672">.</span>value <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)))))))</span>

  println<span style="color:#f92672">(</span>updatedBar<span style="color:#f92672">)</span>
  <span style="color:#75715e">// Bar(List(Fridge(List(Beer(Some(Name(Starobrno)),Some(Stock(6))), Beer(None,Some(Stock(4)))))))
</span></code></pre></div><p>This works, but is less than ideal.</p>
</li>
<li>
<p>We would like to figure out how much stock we have in our bar.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">  bar<span style="color:#f92672">.</span>fridges<span style="color:#f92672">.</span>foldLeft<span style="color:#f92672">(</span><span style="color:#ae81ff">0</span><span style="color:#f92672">)((</span>total<span style="color:#f92672">,</span> fridge<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
    total <span style="color:#f92672">+</span> fridge<span style="color:#f92672">.</span>beers<span style="color:#f92672">.</span>foldLeft<span style="color:#f92672">(</span><span style="color:#ae81ff">0</span><span style="color:#f92672">)((</span>fridgeTotal<span style="color:#f92672">,</span> beer<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      fridgeTotal <span style="color:#f92672">+</span> beer<span style="color:#f92672">.</span>stock<span style="color:#f92672">.</span>getOrElse<span style="color:#f92672">(</span><span style="color:#a6e22e">Stock</span><span style="color:#f92672">(</span><span style="color:#ae81ff">0</span><span style="color:#f92672">)).</span>value<span style="color:#f92672">))</span>

  <span style="color:#75715e">// 8
</span></code></pre></div><p>Again, less than ideal.</p>
</li>
</ul>
<p>So, what can we do to make this code more concise and less convoluted?</p>
<p>Enter optics.</p>
<h4 id="what-do-optics-do-and-why-should-we-care-about-them">What do optics do and why should we care about them?</h4>
<p>To be able to easily traverse deeply nested data structures (which is often the case with API responses) with minimal code and without all these nested maps, folds, conditionals, etc. Optics make very good use of the compositional and pure nature of FP.</p>
<p>Optics are an abstraction characterized by several operations, which revolve around getting a particular field, setting it, or modifying it.</p>
<p>There are several types of optics.</p>
<p><code>NB</code> Optics are called so because you &ldquo;focus&rdquo; into specific elements of nested data structures with them, like the foci of an optical device.</p>
<h3 id="types-of-optics">Types of optics</h3>
<p>I will present three main types of optics: first with a little theory (the type definition and operations it supports), and then with an example with our data using the Monocle library.</p>
<h4 id="lens">Lens</h4>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Theory</p>
<p>Lenses are used for getting and setting fields of deeply nested product types, when you know the value is there. (it&rsquo;s not optional)</p>
<p>A lens is defined by the following operations:</p>
<ol>
<li><code>get</code> (to get the value of the focused field)</li>
<li><code>set</code> (to change the value of the focused field)</li>
<li><code>modify</code> (to get an element and apply a function to it) - this can be expressed through <code>get</code> and <code>set</code> so it&rsquo;s not required in an implementation</li>
</ol>
<p>The <code>SimpleLens</code> describes a structure of type <code>S</code> that contains a focused field of type <code>A</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SimpleLens</span><span style="color:#f92672">[</span><span style="color:#66d9ef">S</span>, <span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> get<span style="color:#f92672">(</span>s<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">S</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span>
  <span style="color:#66d9ef">def</span> set<span style="color:#f92672">(</span>s<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">S</span><span style="color:#f92672">,</span> b<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">S</span>
  <span style="color:#66d9ef">def</span> modify<span style="color:#f92672">(</span>s<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">S</span><span style="color:#f92672">)(</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> A<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">S</span> <span style="color:#f92672">=</span> set<span style="color:#f92672">(</span>s<span style="color:#f92672">,</span> f<span style="color:#f92672">(</span>get<span style="color:#f92672">(</span>s<span style="color:#f92672">)))</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>The type is actually a bit more complicated</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Lens</span><span style="color:#f92672">[</span><span style="color:#66d9ef">S</span>, <span style="color:#66d9ef">T</span>, <span style="color:#66d9ef">A</span>, <span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> get<span style="color:#f92672">(</span>s<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">S</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span>
  <span style="color:#66d9ef">def</span> set<span style="color:#f92672">(</span>s<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">S</span><span style="color:#f92672">,</span> b<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">B</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">T</span>
  <span style="color:#66d9ef">def</span> modify<span style="color:#f92672">(</span>s<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">S</span><span style="color:#f92672">)(</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> B<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">T</span> <span style="color:#f92672">=</span> set<span style="color:#f92672">(</span>s<span style="color:#f92672">,</span> f<span style="color:#f92672">(</span>get<span style="color:#f92672">(</span>s<span style="color:#f92672">)))</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">// so SimpleLens is
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">SimpleLens</span><span style="color:#f92672">[</span><span style="color:#66d9ef">S</span>, <span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Lens</span><span style="color:#f92672">[</span><span style="color:#66d9ef">S</span>, <span style="color:#66d9ef">S</span>, <span style="color:#66d9ef">A</span>, <span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
</code></pre></div><ul>
<li>S - input structure type, our nested data structure</li>
<li>T - output structure type, since setting the field can change the type (changing an int field to a string for example)</li>
<li>A - input field type</li>
<li>B - output field type - again, the input type might change</li>
</ul>
<p>The <code>SimpleLens</code> is a convenient alias for when the input and output types are the same.</p>
<p>We create specific lenses for the fields we want to work with, e.g. we &ldquo;focus&rdquo; on the field.</p>
<p>To create a lens for the name field of the <code>Beer</code> type (let&rsquo;s ignore the <code>Option</code> there for now, we&rsquo;ll get to that later), we need a way to get a field from a case class and a way to set it. The minimal implementation for a <code>Lens</code> is to define <code>get</code> and <code>set</code> since <code>modify</code> can be expressed through them.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Name</span><span style="color:#f92672">(</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Beer</span><span style="color:#f92672">(</span>name<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Name</span><span style="color:#f92672">)</span>

<span style="color:#75715e">// We focus on the field with type Name of the Beer class
</span><span style="color:#75715e"></span><span style="color:#66d9ef">val</span> beerName <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SimpleLens</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Beer</span>, <span style="color:#66d9ef">Name</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> get<span style="color:#f92672">(</span>s<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Beer</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Name</span> <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>name
  <span style="color:#66d9ef">def</span> set<span style="color:#f92672">(</span>s<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Beer</span><span style="color:#f92672">,</span> newName<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Name</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Beer</span> <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>name <span style="color:#66d9ef">=</span> newName<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>

beerName<span style="color:#f92672">.</span>get<span style="color:#f92672">(</span><span style="color:#a6e22e">Beer</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Name</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Staropramen&#34;</span><span style="color:#f92672">)))</span> <span style="color:#75715e">// Name(Staropramen)
</span><span style="color:#75715e"></span>beerName<span style="color:#f92672">.</span>set<span style="color:#f92672">(</span><span style="color:#a6e22e">Beer</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Name</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Staropramen&#34;</span><span style="color:#f92672">)),</span> <span style="color:#a6e22e">Name</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Starobrno&#34;</span><span style="color:#f92672">))</span> <span style="color:#75715e">// Beer(Name(Staropramen))
</span><span style="color:#75715e"></span>beerName<span style="color:#f92672">.</span>modify<span style="color:#f92672">(</span><span style="color:#a6e22e">Beer</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Name</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Staropramen&#34;</span><span style="color:#f92672">)))(</span>n <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Name</span><span style="color:#f92672">(</span>n<span style="color:#f92672">.</span>value <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;!&#34;</span><span style="color:#f92672">))</span> <span style="color:#75715e">// Beer(Name(Staropramen!))
</span></code></pre></div></li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>In Practice</p>
<p>The Monocle library provides convenient apply methods for creating a Lens by providing a get and set function. It also provides macros such as <code>GenLens</code> that avoid a lot of the boilerplate, but I&rsquo;m not going to touch on them in this post.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">import</span> monocle.Lens

<span style="color:#66d9ef">val</span> barFridges <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Lens</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Bar</span>, <span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Fridge</span><span style="color:#f92672">]](</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>fridges<span style="color:#f92672">)(</span>newFridges <span style="color:#66d9ef">=&gt;</span> bar <span style="color:#66d9ef">=&gt;</span> bar<span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>fridges <span style="color:#66d9ef">=</span> newFridges<span style="color:#f92672">))</span>

<span style="color:#66d9ef">val</span> fridgeBeers <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Lens</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Fridge</span>, <span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Beer</span><span style="color:#f92672">]](</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>beers<span style="color:#f92672">)(</span>newBeers <span style="color:#66d9ef">=&gt;</span> fridge <span style="color:#66d9ef">=&gt;</span> fridge<span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>beers <span style="color:#66d9ef">=</span> newBeers<span style="color:#f92672">))</span>

<span style="color:#75715e">// We&#39;ll get to the options soon
</span><span style="color:#75715e"></span><span style="color:#66d9ef">val</span> beerStock <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Lens</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Beer</span>, <span style="color:#66d9ef">Stock</span><span style="color:#f92672">](</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>stock<span style="color:#f92672">)(</span>newStock <span style="color:#66d9ef">=&gt;</span> beer <span style="color:#66d9ef">=&gt;</span> beer<span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>stock <span style="color:#66d9ef">=</span> newStock<span style="color:#f92672">))</span>

<span style="color:#66d9ef">val</span> beerName <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Lens</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Beer</span>, <span style="color:#66d9ef">Name</span><span style="color:#f92672">](</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>name<span style="color:#f92672">)(</span>newName <span style="color:#66d9ef">=&gt;</span> beer <span style="color:#66d9ef">=&gt;</span> beer<span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>name <span style="color:#66d9ef">=</span> newName<span style="color:#f92672">))</span>

<span style="color:#75715e">// Some examples
</span><span style="color:#75715e"></span>barFridges<span style="color:#f92672">.</span>get<span style="color:#f92672">(</span>bar<span style="color:#f92672">)</span>
fridgeBeers<span style="color:#f92672">.</span>set<span style="color:#f92672">(</span>fridge<span style="color:#f92672">,</span> <span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>beer1<span style="color:#f92672">,</span> beer2<span style="color:#f92672">))</span>
beerStock<span style="color:#f92672">.</span>modify<span style="color:#f92672">(</span>beer<span style="color:#f92672">)(</span>s <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Stock</span><span style="color:#f92672">(</span>s<span style="color:#f92672">.</span>value <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span><span style="color:#f92672">))</span>
</code></pre></div></li>
</ul>
<h4 id="prism">Prism</h4>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Theory</p>
<p>Prisms are used for getting and setting fields of deeply nested product types when the value might not be there. More generally, a prism captures a certain constructor of a sum type (since Option is simply a sum type with two constructors).</p>
<p>A nice way to think about prisms is that they define an is-a relationship and lenses define a has-a relationship.</p>
<p>A prism is defined by:</p>
<ol>
<li><code>match</code> (a matcher function that returns an <code>Either</code> - Left if the constructor is not matched, Right if it is)</li>
<li><code>construct</code> (a function to wrap a value into the constructor)</li>
</ol>
<p>These operations are used to define some more convenient ones:</p>
<ol>
<li><code>preview</code> (to get the value of the focused field, or None if it&rsquo;s not there) - this is analoguous to get, but returns an <code>Option</code></li>
<li><code>review</code> (to wrap a value in the constructor)</li>
</ol>
<p>The <code>SimplePrism</code> type describes a structure <code>S</code> that contains a focused field of type <code>A</code> that might not be there</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SimplePrism</span><span style="color:#f92672">[</span><span style="color:#66d9ef">S</span>, <span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">// because reserved word
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">def</span> matcher<span style="color:#f92672">(</span>a<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Either</span><span style="color:#f92672">[</span><span style="color:#66d9ef">S</span>, <span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
  <span style="color:#66d9ef">def</span> construct<span style="color:#f92672">(</span>a<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">S</span>

  <span style="color:#75715e">// the double match
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">def</span> preview<span style="color:#f92672">(</span>a<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span>matcher<span style="color:#f92672">(</span>a<span style="color:#f92672">)</span> <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Right</span><span style="color:#f92672">(</span>a<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>a<span style="color:#f92672">)</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Left</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">None</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">def</span> review<span style="color:#f92672">(</span>a<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span>construct<span style="color:#f92672">(</span>a<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>The type is actually a bit more complicated</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Prism</span><span style="color:#f92672">[</span><span style="color:#66d9ef">S</span>, <span style="color:#66d9ef">T</span>, <span style="color:#66d9ef">A</span>, <span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">// we might choose a different type for our Left, some error for example
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">def</span> matcher<span style="color:#f92672">(</span>a<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Either</span><span style="color:#f92672">[</span><span style="color:#66d9ef">T</span>, <span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
  <span style="color:#75715e">// he we wrap whatever the result of our computation is back into the result sum type
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">def</span> construct<span style="color:#f92672">(</span>b<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">B</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">T</span>

  <span style="color:#66d9ef">def</span> preview<span style="color:#f92672">(</span>a<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span>matcher<span style="color:#f92672">(</span>a<span style="color:#f92672">)</span> <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Right</span><span style="color:#f92672">(</span>a<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>a<span style="color:#f92672">)</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Left</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">None</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">def</span> review<span style="color:#f92672">(</span>b<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">B</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">T</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span>construct<span style="color:#f92672">(</span>b<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">// so SimplePrism is
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">SimplePrism</span><span style="color:#f92672">[</span><span style="color:#66d9ef">S</span>, <span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Prism</span><span style="color:#f92672">[</span><span style="color:#66d9ef">S</span>, <span style="color:#66d9ef">S</span>, <span style="color:#66d9ef">A</span>, <span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
</code></pre></div><ul>
<li>S - input structure type</li>
<li>T - output structure type, since setting the field can change the type (changing an int field to string for example)</li>
<li>A - input field type, a variant of a sum type</li>
<li>B - output field type - again, might change, a variant of a sum type</li>
</ul>
<p>The <code>SimplePrism</code> is a convenient alias for when the input and output types are the same.</p>
<p>Let&rsquo;s create a prism for the <code>Some</code> constructor of the <code>Option</code> type, since we have several optional fields in our data.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#75715e">// puns
</span><span style="color:#75715e"></span><span style="color:#66d9ef">val</span> somePrism <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SimplePrism</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>, <span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> matcher<span style="color:#f92672">(</span>a<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Either</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>, <span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> a <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// the value is there
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>y<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Right</span><span style="color:#f92672">(</span>y<span style="color:#f92672">)</span>
    <span style="color:#75715e">// the value is missing
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">None</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Left</span><span style="color:#f92672">(</span><span style="color:#a6e22e">None</span><span style="color:#f92672">)</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">def</span> construct<span style="color:#f92672">(</span>a<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>a<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>

somePrism<span style="color:#f92672">.</span>preview<span style="color:#f92672">(</span><span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#ae81ff">5</span><span style="color:#f92672">))</span> <span style="color:#75715e">// Some(5)
</span><span style="color:#75715e"></span>somePrism<span style="color:#f92672">.</span>review<span style="color:#f92672">(</span><span style="color:#ae81ff">5</span><span style="color:#f92672">)</span> <span style="color:#75715e">// Some(5)
</span></code></pre></div><p>This isn&rsquo;t the most sensible example in of itself, but when we get to composing optics it&rsquo;ll be very convenient. In fact, it&rsquo;s so convenient that there is another type of optic, <code>Optional</code>, which composes a <code>Lens</code> and this prism to create lenses for optional fields.</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>In Practice</p>
<p>Since we will be using mainly the simple versions of the optics in our explorations (without changing the output types), we can use <code>Maybe</code> in our matching function instead of <code>Either</code>, which is there to keep the context of our switched <code>T</code> type.
Luckily, Monocle provides an apply method to supply a matching function with <code>Maybe</code> as the return type. What&rsquo;s more, it provides a <code>Prism.partial</code> constructor, which allows a partial function to be passed, making the code even more concise. Let&rsquo;s rewrite our prism for <code>Some</code> using Monocle.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">import</span> monocle.Prism

<span style="color:#66d9ef">val</span> prismOption<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Prism</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>, <span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Prism</span><span style="color:#f92672">.</span>partial<span style="color:#f92672">[</span><span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>, <span style="color:#66d9ef">A</span><span style="color:#f92672">]{</span><span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>v<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> v<span style="color:#f92672">}(</span><span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">))</span>
</code></pre></div><p>Neat, right?</p>
<p>Preview is called <code>getOption</code>, and review is <code>reverseGet</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">prismOption<span style="color:#f92672">.</span>getOption<span style="color:#f92672">(</span><span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Name</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Starobrno&#34;</span><span style="color:#f92672">)))</span> <span style="color:#75715e">// Some(Name(Starobrno))
</span><span style="color:#75715e"></span>prismOption<span style="color:#f92672">.</span>reverseGet<span style="color:#f92672">(</span><span style="color:#a6e22e">Name</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Starobrno&#34;</span><span style="color:#f92672">))</span> <span style="color:#75715e">// Some(Name(Starobrno))
</span></code></pre></div><p>I promise, it&rsquo;ll make sense in a bit.</p>
</li>
</ul>
<h4 id="traversal">Traversal</h4>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Theory</p>
<p>Traversals are the meat and bread of traversing(get it?) nested data, because they deal with lists of values. A traversal focuses on 0 or more values of a type, or a field that is a list of values of the same type. So a lens is actually a traversal that focuses on a single value, and a prism is a traversal that focuses on on 0 or 1 value.</p>
<p>A Traversal is basically a wrapper around types that can be traversed. <code>traverse</code> is like <code>map</code>, but the function that is applied to each element of the structure is effectful. A <code>Traversal</code> allows us to transform values of a field in any way we like.</p>
<p>A traversal is, not surprisingly, defined by the following function:</p>
<ol>
<li><code>traverse</code> (apply an effectful function to each element of a structure)</li>
</ol>
<p>This operation is used to define very many others, and implementing them will take longer than a reasonably sized blog post, so i&rsquo;ll just show their usage.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SimpleTraversal</span><span style="color:#f92672">[</span><span style="color:#66d9ef">S</span>, <span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">// traverse requires that the effect is an instance of Applicative
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">def</span> traverse<span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Applicative</span><span style="color:#f92672">](</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> F<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])(</span>s<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">S</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">S</span><span style="color:#f92672">]</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>As always, the type can be more complicated.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Traversal</span><span style="color:#f92672">[</span><span style="color:#66d9ef">S</span>, <span style="color:#66d9ef">T</span>, <span style="color:#66d9ef">A</span>, <span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> traverse<span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Applicative</span><span style="color:#f92672">](</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> F<span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">])(</span>s<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">S</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">T</span><span style="color:#f92672">]</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">type</span> <span style="color:#66d9ef">SimpleTraversal</span><span style="color:#f92672">[</span><span style="color:#66d9ef">S</span>, <span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Traversal</span><span style="color:#f92672">[</span><span style="color:#66d9ef">S</span>, <span style="color:#66d9ef">S</span>, <span style="color:#66d9ef">A</span>, <span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
</code></pre></div><p>The type parameter explanation is the same as for the previous optics.</p>
<p>To implement a traversal, we can use the <code>Traverse</code> type class from cats (not to be confused with the default <code>Traversable</code> from Scala, though they sure meant us to confuse the two, since that is what <code>Traverse</code> is called in Haskell) and simply take its <code>traverse</code> method implementation.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#75715e">// List[_] is an instance of ~Traverse~
</span><span style="color:#75715e"></span><span style="color:#66d9ef">val</span> listTraversal<span style="color:#f92672">[</span><span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>, <span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SimpleTraversal</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> traverse<span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Applicative</span><span style="color:#f92672">](</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> F<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])(</span>s<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span> s<span style="color:#f92672">.</span>traverse<span style="color:#f92672">(</span>f<span style="color:#f92672">)</span> <span style="color:#75715e">// assuming an extension method traverse is defined
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div></li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>In Practice</p>
<p>We&rsquo;ll define traversals for our list of fridges and list of bars. Monocle provides a <code>Traversal.fromTraverse</code> constructor that does what we did above. It has a <code>Traverse</code> type class constraint.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">import</span> monocle.Traversal

<span style="color:#66d9ef">val</span> fridgeTraversal<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Traversal</span><span style="color:#f92672">[</span><span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Fridge</span><span style="color:#f92672">]</span>, <span style="color:#66d9ef">Fridge</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Traversal</span><span style="color:#f92672">.</span>fromTraverse<span style="color:#f92672">[</span><span style="color:#66d9ef">List</span>, <span style="color:#66d9ef">Fridge</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">val</span> beersTraversal<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Traversal</span><span style="color:#f92672">[</span><span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Beer</span><span style="color:#f92672">]</span>, <span style="color:#66d9ef">Beer</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Traversal</span><span style="color:#f92672">.</span>fromTraverse<span style="color:#f92672">[</span><span style="color:#66d9ef">List</span>, <span style="color:#66d9ef">Beer</span><span style="color:#f92672">]</span>
</code></pre></div><p>We can get all beers, which will make more sense when we compose the optics</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> beer1 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Beer</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Name</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Starobrno&#34;</span><span style="color:#f92672">)),</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Stock</span><span style="color:#f92672">(</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)))</span>
<span style="color:#66d9ef">val</span> beer2 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Beer</span><span style="color:#f92672">(</span><span style="color:#a6e22e">None</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Stock</span><span style="color:#f92672">(</span><span style="color:#ae81ff">3</span><span style="color:#f92672">)))</span>

<span style="color:#66d9ef">val</span> beers <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>beer1<span style="color:#f92672">,</span> beer2<span style="color:#f92672">)</span>

beersTraversal<span style="color:#f92672">.</span>getAll<span style="color:#f92672">(</span>beers<span style="color:#f92672">)</span> <span style="color:#75715e">// List(beer1, beer2)
</span></code></pre></div><p>For a more sensible example, we can fold them to calculate all the stock (using a monoid for Stock). I will cheat a bit here and use a compose, which I will cover in the next (culminative) section.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">import</span> monocle.Optional
<span style="color:#66d9ef">import</span> cats.Monoid

<span style="color:#75715e">// Composing a lens for Stock and a prism for Option yields an Optional
</span><span style="color:#75715e"></span><span style="color:#66d9ef">val</span> beerStockOptional <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Optional</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Beer</span>, <span style="color:#66d9ef">Stock</span><span style="color:#f92672">](</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>stock<span style="color:#f92672">)(</span>newStock <span style="color:#66d9ef">=&gt;</span> beer <span style="color:#66d9ef">=&gt;</span> beer<span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>stock <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>newStock<span style="color:#f92672">)))</span>

<span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> stockMonoid<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Monoid</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Stock</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Monoid</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Stock</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">def</span> empty<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Stock</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Stock</span><span style="color:#f92672">(</span><span style="color:#ae81ff">0</span><span style="color:#f92672">)</span>
  <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">def</span> combine<span style="color:#f92672">(</span>x<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Stock</span><span style="color:#f92672">,</span> y<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Stock</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Stock</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Stock</span><span style="color:#f92672">(</span>x<span style="color:#f92672">.</span>value <span style="color:#f92672">+</span> y<span style="color:#f92672">.</span>value<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">// uses the Stock monoid
</span><span style="color:#75715e"></span>beersL<span style="color:#f92672">.</span>composeOptional<span style="color:#f92672">(</span>beerStockOptional<span style="color:#f92672">).</span>fold<span style="color:#f92672">(</span>beers<span style="color:#f92672">)</span> <span style="color:#75715e">// Stock(7)
</span><span style="color:#75715e"></span>
</code></pre></div></li>
</ul>
<h3 id="composability">Composability</h3>
<p>Now that we&rsquo;ve looked at some of the main types of optics, it&rsquo;s time to see how they can be used with real data (or in our case, the data we defined at the beginning of the post). The power of optics lies in their ability to compose. By composing them we can perform the nested traversal that makes optics so useful.</p>
<p>Skipping over the theory, as that is a post on its own, the main thing to note is that, for the optics we presented, every one of them, composed with a <code>Traversal</code>, yields a <code>Traversal</code>. This means that a composed optic will most often be a <code>Traversal</code> and will begin with a <code>Traversal</code> of some kind, either for a specific field (since a <code>Lens</code> is a <code>Traversal</code>), followed by a list of something. Sound familiar?</p>
<p>I&rsquo;m going to go straight to the Monocle examples for this.</p>
<h3 id="optics-in-full">Optics in full</h3>
<h4 id="optics-for-a-bar">Optics for a bar</h4>
<p>So we want to focus on the <code>Stock</code> of the beers in our bar, starting from the top. Let&rsquo;s see how that goes.</p>
<p>First we define the separate optics. Yet again, i&rsquo;m not using the macros provided by Monocle.</p>
<p>Imports</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">import</span> monocle.<span style="color:#f92672">{</span><span style="color:#a6e22e">Lens</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">Traversal</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">Optional</span><span style="color:#f92672">}</span>
</code></pre></div><p>A Lens for the &ldquo;fridges&rdquo; field</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> barFridges<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Lens</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Bar</span>, <span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Fridge</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Lens</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Bar</span>, <span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Fridge</span><span style="color:#f92672">]](</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>fridges<span style="color:#f92672">)(</span>newFridges <span style="color:#66d9ef">=&gt;</span> bar <span style="color:#66d9ef">=&gt;</span> bar<span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>fridges <span style="color:#66d9ef">=</span> newFridges<span style="color:#f92672">))</span>
</code></pre></div><p>Now we need to Traverse the fridges</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> fridgesL<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Traversal</span><span style="color:#f92672">[</span><span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Fridge</span><span style="color:#f92672">]</span>, <span style="color:#66d9ef">Fridge</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Traversal</span><span style="color:#f92672">.</span>fromTraverse<span style="color:#f92672">[</span><span style="color:#66d9ef">List</span>, <span style="color:#66d9ef">Fridge</span><span style="color:#f92672">]</span>
</code></pre></div><p>A Lens for the &ldquo;beers&rdquo; field</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> fridgeBeers<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Lens</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Fridge</span>, <span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Beer</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Lens</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Fridge</span>, <span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Beer</span><span style="color:#f92672">]](</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>beers<span style="color:#f92672">)(</span>newBeers <span style="color:#66d9ef">=&gt;</span> fridge <span style="color:#66d9ef">=&gt;</span> fridge<span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>beers <span style="color:#66d9ef">=</span> newBeers<span style="color:#f92672">))</span>
</code></pre></div><p>Now we need to Traverse the beers</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> beersL<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Traversal</span><span style="color:#f92672">[</span><span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Beer</span><span style="color:#f92672">]</span>, <span style="color:#66d9ef">Beer</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Traversal</span><span style="color:#f92672">.</span>fromTraverse<span style="color:#f92672">[</span><span style="color:#66d9ef">List</span>, <span style="color:#66d9ef">Beer</span><span style="color:#f92672">]</span>
</code></pre></div><p>An optional for the &ldquo;stock&rdquo; field, since it&rsquo;s optional</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> beerStock<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Optional</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Beer</span>, <span style="color:#66d9ef">Stock</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Optional</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Beer</span>, <span style="color:#66d9ef">Stock</span><span style="color:#f92672">](</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>stock<span style="color:#f92672">)(</span>newStock <span style="color:#66d9ef">=&gt;</span> beer <span style="color:#66d9ef">=&gt;</span> beer<span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>stock <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>newStock<span style="color:#f92672">))</span>
</code></pre></div><p>And now&hellip; we compose. The function names should be self explanatory.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> barStocks<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Traversal</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Bar</span>, <span style="color:#66d9ef">Stock</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
  barFridges<span style="color:#f92672">.</span>
    composeTraversal<span style="color:#f92672">(</span>fridgesL<span style="color:#f92672">).</span>
    composeLens<span style="color:#f92672">(</span>fridgeBeers<span style="color:#f92672">).</span>
    composeTraversal<span style="color:#f92672">(</span>beersL<span style="color:#f92672">).</span>
    composeOptional<span style="color:#f92672">(</span>beerStock<span style="color:#f92672">)</span>
</code></pre></div><p>And there we have it. Now, to test it out.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> firstFridgeBeer1 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Beer</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Name</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Starobrno&#34;</span><span style="color:#f92672">)),</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Stock</span><span style="color:#f92672">(</span><span style="color:#ae81ff">5</span><span style="color:#f92672">)))</span>
<span style="color:#66d9ef">val</span> firstFridgeBeer2 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Beer</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Name</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)),</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Stock</span><span style="color:#f92672">(</span><span style="color:#ae81ff">2</span><span style="color:#f92672">)))</span>
<span style="color:#66d9ef">val</span> secondFridgeBeer1 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Beer</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Name</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Starobrno&#34;</span><span style="color:#f92672">)),</span> <span style="color:#a6e22e">None</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> secondFridgeBeer2 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Beer</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Name</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Staropramen&#34;</span><span style="color:#f92672">)),</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Stock</span><span style="color:#f92672">(</span><span style="color:#ae81ff">6</span><span style="color:#f92672">)))</span>

<span style="color:#66d9ef">val</span> fridges <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>
  <span style="color:#a6e22e">Fridge</span><span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>firstFridgeBeer1<span style="color:#f92672">,</span> firstFridgeBeer2<span style="color:#f92672">)),</span>
  <span style="color:#a6e22e">Fridge</span><span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span>secondFridgeBeer1<span style="color:#f92672">,</span> secondFridgeBeer2<span style="color:#f92672">)))</span>
<span style="color:#66d9ef">val</span> bar <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Bar</span><span style="color:#f92672">(</span>fridges<span style="color:#f92672">)</span>
</code></pre></div><p>Get the total stock. We again require the <code>Stock</code> monoid implicit in scope.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">println<span style="color:#f92672">(</span>barStocks<span style="color:#f92672">.</span>fold<span style="color:#f92672">(</span>bar<span style="color:#f92672">))</span> <span style="color:#75715e">// Stock(13)
</span></code></pre></div><p>Bump all the stock.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">println<span style="color:#f92672">(</span>barStocks<span style="color:#f92672">.</span>fold<span style="color:#f92672">(</span>barStocks<span style="color:#f92672">.</span>modify<span style="color:#f92672">(</span>s <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Stock</span><span style="color:#f92672">(</span>s<span style="color:#f92672">.</span>value <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">))(</span>bar<span style="color:#f92672">)))</span> <span style="color:#75715e">// Stock(16)
</span></code></pre></div><p>I think that looks way better than the previous solutions.</p>
<h4 id="operators">Operators</h4>
<p>Finally, since Haskell libraries enjoy using fancy operators so much (not to debate on their usefulness or anything), Monocle provides some of those as well:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> barStocksOperators<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Traversal</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Bar</span>, <span style="color:#66d9ef">Stock</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
  barFridges <span style="color:#f92672">^|-&gt;&gt;</span> fridgesL <span style="color:#f92672">^|-&gt;</span> fridgeBeers <span style="color:#f92672">^|-&gt;&gt;</span> beersL <span style="color:#f92672">^|-?</span> beerStock
</code></pre></div><p>I&rsquo;ll leave the decision up to you whether to use them or not.</p>
<h3 id="summary-and-resources">Summary and Resources</h3>
<p>I hope this journey through optics has been a useful and informative one for you. When used correctly, they can result in much cleaner and declarative code for accessing fields. Granted, you do need a bit of context, but that&rsquo;s the usual case. And they have fancy names!</p>
<p>Here are some resources if you want to learn more about optics. There are more types of optics that I didn&rsquo;t cover here, but they are usually some modification of the three presented.</p>
<ol>
<li><a href="https://www.optics.dev/Monocle/">The Monocle Documentation</a></li>
<li><a href="https://github.com/Nimor111/optics-examples">Repository with the examples for this post</a></li>
<li><a href="https://hackage.haskell.org/package/lens">Haskell lens library</a> - this is one of the most famous optics libraries, it&rsquo;s a bit advanced in its explanations though</li>
<li><a href="https://impurepics.com/posts/2020-03-22-optics.html">Very nice optics pictures with explanations</a> - mentioned in this article</li>
</ol>
<h2 id="links-to-this-note">Links to this note</h2>
<ul>
<li><a href="/timeline/home/gbojinov/nextcloud/org-roam/20210120223526-index/">Index</a></li>
</ul>
<blockquote>
<p>Welcome to my knowledge base!</p>
</blockquote>

      </div>
    </article>

    <hr />

    <div class="post-info">

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        2718 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        2021-01-20 00:00 &#43;0200
      </p>
 
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h"></span>
          <hr />
        </div>

        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="http://notes.gbojinov.xyz/timeline/home/gbojinov/nextcloud/org-roam/20210120223526-index/">
                <span class="button__icon">←</span>
                <span class="button__text">Index</span>
              </a>
            </span>
          

          
        </div>
      </div>
    


    

  </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2021</span>
            
                <span><a href="http://notes.gbojinov.xyz">timeline</a></span>
            
             
        </div>
    </div> 
</footer>
<script type="text/javascript">
    $(function(){

  window.sr = ScrollReveal();

  if ($(window).width() < 768) {

    if ($('.timeline-content').hasClass('js--fadeInLeft')) {
        $('.timeline-content').removeClass('js--fadeInLeft').addClass('js--fadeInRight');
    }

    sr.reveal('.js--fadeInRight', {
        origin: 'right',
        distance: '300px',
        easing: 'ease-in-out',
        duration: 800,
      });

  } else {
    
    sr.reveal('.js--fadeInLeft', {
        origin: 'left',
        distance: '300px',
          easing: 'ease-in-out',
        duration: 800,
      });

      sr.reveal('.js--fadeInRight', {
        origin: 'right',
        distance: '300px',
        easing: 'ease-in-out',
        duration: 800,
      });

  }
  
  sr.reveal('.js--fadeInLeft', {
        origin: 'left',
        distance: '300px',
          easing: 'ease-in-out',
        duration: 800,
      });

      sr.reveal('.js--fadeInRight', {
        origin: 'right',
        distance: '300px',
        easing: 'ease-in-out',
        duration: 800,
      });


});

</script>
            
        </div>

        




<script type="text/javascript" src="/bundle.min.dc716e9092c9820b77f96da294d0120aeeb189b5bcea9752309ebea27fd53bbe6b13cffb2aca8ecf32525647ceb7001f76091de4199ac5a3caa432c070247f5b.js" integrity="sha512-3HFukJLJggt3&#43;W2ilNASCu6xibW86pdSMJ6&#43;on/VO75rE8/7KsqOzzJSVkfOtwAfdgkd5BmaxaPKpDLAcCR/Ww=="></script>



    </body>
</html>
